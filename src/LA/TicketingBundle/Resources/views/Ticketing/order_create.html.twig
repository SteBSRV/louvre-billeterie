{# src/LA/TicketingBundle/Resources/views/Ticketing/order_create.html.twig #}
{% extends "LAAppBundle::layout.html.twig" %}

{% block title %}
  Billeterie - {{ parent() }}
{% endblock %}

{% block body %}

  <h2>Billeterie</h2>
  
  {% for type, messages in app.session.flashbag.all %}
    {% for message in messages %}
      {%if type == 'error'%} {% set type = 'danger' %} {%endif%}
        <div class="alert alert-{{ type }}">
            {{ message|raw }}
        </div>
    {% endfor %}
  {% endfor %}

  <div class="well">
    {{ form(form) }}
  </div>

  <script type="text/javascript">
    jQuery(document).ready(function() {
        jQuery('#la_ticketingbundle_order_nbTickets').change(function(e) {
            e.preventDefault();

            var nbTickets = jQuery(this).val();

            jQuery('#la_ticketingbundle_order_tickets').empty();
            var ticketsList = jQuery('#la_ticketingbundle_order_tickets');

            for (var i = 1; i < nbTickets; i++) {
              var newWidget = ticketsList.attr('data-prototype');
      
              newWidget = newWidget.replace(/__name__/g, 'Ticket-' + i);
              newWidget = newWidget.replace(/label__/, '');

              var newLi = jQuery('<li></li>').html(newWidget);
              newLi.append('<hr class="ticket-separation"/>');
              newLi.appendTo(ticketsList);
            }

            // Info for the reduced price
            jQuery('.reduced-info').change(function() {
              if ($(this).is(':checked')) {
                alert('Justificatif nécessaire pour les tarifs réduits');
              };
            });
        });
    })
</script>

{% endblock %}